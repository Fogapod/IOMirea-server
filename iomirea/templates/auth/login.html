<!DOCTYPE html>
<meta charset="utf-8" />
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script language="javascript" type="text/javascript">
     		$(function() {
			var app_name = "{{ app_name }}"
			var redirect_uri = "{{ redirect_uri }}"
			var scope = "{{ scope }}"
			var state = "{{ state }}"
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function() {
				if (this.readyState !== XMLHttpRequest.DONE) {
					return
				}
				if (this.status === 401) {
					alert('Wrong login or password')
				} else if (this.status === 200) {
					var delim
					if (redirect_uri.includes("?")) {
						delim = "&"
					} else {
						delim = "?"
					}
					var redirect = redirect_uri+delim+'code='+this.response
					if (!(redirect.startsWith('http://') || redirect.startsWith('https://'))) {
						redirect = '//' + redirect
					}
					if (state !== '') {
						redirect += '&state='+state
					}
					window.location.assign(redirect)
				} else {
					alert('Something went terribly wrong. Please, try to refresh page or return back later')
				}
			}
			$('#auth_form').on('submit', function(e) {
				// TODO: let user modify scope
				xhr.open('POST', window.location.href, true)
	                        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
				xhr.send('login='+$('#login_field').val()+'&password='+$('#password_field').val())
			})
		});
		</script>
	</head>
	
	
	
<body>
    <form id="auth_form" onsubmit="return false;">
      <header style="background-color: #F5B530;">
		  <span 
				style="color: #FF8C00; font-size: 170%; font-family: 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', 'DejaVu Sans', Verdana, sans-serif;"><img src="logo.png" width="100" height="95" alt=""/><span style="text-align: left; color: #6A5ACD;">IOMirea</span></span>      </header>
<div> 
  <form id="auth_form" onsubmit="return false;">
			<p>&nbsp;</p>
			<p>&nbsp;</p>
			<p>&nbsp;</p>
			<p>&nbsp;</p>
			<table width="200" border="1" align="center">
			  <tbody>
			    <tr>
			      <td bgcolor="#5440D3" style="text-align: center; color: #FFFFFF;"><p>Login<br>
                    <input type="text" id="login_field" name="login">
                    <br>
Password<br>
<input type="text" id="password_field" name="password">
			      </p>
		          <p><span style="text-align: center">
		            <input type="submit" value="login">
		          </span> </p></td>
		        </tr>
			   
		      </tbody>
    </table>
			<p><br><br><br>
			</p>
			<p>&nbsp;</p>
			<p>&nbsp;</p>
			<p>&nbsp;</p>
			<p>&nbsp;</p>
			<p>&nbsp;</p>
			<p style="text-align: right; font-size: 14px; color: #5440D3;">Scope: {{ scope }}<br>
Application: {{ app_name }}<br>
Made by {{ app_author_name }} ( {{ app_author_id }} )</p>
		</form>
</div>
  </form>
  </body>
</html>
